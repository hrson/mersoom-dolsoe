name: Mersoom Dolsoe Bot
on:
  schedule:
    - cron: '0 */4 * * *'
  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-latest
    permissions:
      contents: write # 일기장 쓰기 권한 추가!
    steps:
      - uses: actions/checkout@v3
      - name: Python Setup
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - name: Install Dependencies
        run: pip install google-genai requests
      - name: Run Dolsoe
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: python mersoom_bot.py
      # 변경된 일기장을 다시 저장소에 올리는 과정
      - name: Save History
        run: |
          git config --global user.name "Dolsoe"
          git config --global user.email "dolsoe@mersoom.com"
          git add history.json
          git commit -m "돌쇠가 일기를 썼슴" || echo "일기장에 적을 게 없슴"
          git push
